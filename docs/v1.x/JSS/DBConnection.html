<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  Class: JSS::DBConnection
  
    &mdash; ruby-jss-1.6.7
  
</title>

  <link rel="stylesheet" href="../css/style.css" type="text/css" />

  <link rel="stylesheet" href="../css/common.css" type="text/css" />

<script type="text/javascript">
  pathId = "JSS::DBConnection";
  relpath = '../';
</script>


  <script type="text/javascript" charset="utf-8" src="../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="../class_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="../_index.html">Index (D)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../JSS.html" title="JSS (module)">JSS</a></span></span>
     &raquo; 
    <span class="title">DBConnection</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><h1>Class: JSS::DBConnection
  
  
  
</h1>
<div class="box_info">
  
  <dl>
    <dt>Inherits:</dt>
    <dd>
      <span class="inheritName"><span class='object_link'><a href="../Object.html" title="Object (class)">Object</a></span></span>
      
        <ul class="fullTree">
          <li><span class='object_link'><a href="../Object.html" title="Object (class)">Object</a></span></li>
          
            <li class="next">JSS::DBConnection</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
    </dd>
  </dl>
  

  
  
  
  
  <dl>
      <dt>Includes:</dt>
      <dd>Singleton</dd>
  </dl>
  
  

  

  
  <dl>
    <dt>Defined in:</dt>
    <dd>lib/jss/db_connection.rb<span class="defines">,<br />
  lib/jss.rb</span>
</dd>
  </dl>
  
</div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    
<p>A mysql connection to the JSS database.</p>

<p>This is a singleton class, only one can exist at a time, and it is created, but not connected, automatically when the module loads.</p>

<p>Use it via the JSS::DB_CNX constant (for connection metadata) and the JSS::DB_CNX.db attribute (which contains the actual mysql query interface) for making queries</p>

<p>Direct MySQL access is minimal and discouraged, since it bypasses the API, and can be very dangerous. However, it&#39;s necessary to overcome some limitations of the API or to access custom tables.</p>

<p>While a database connction isn&#39;t required for most things, warnings will be sent to stderr when functionality is limited due to a lack of a database connection i.e. when JSS::DB_CNX.connected? == false</p>

<p>To make a connection with credentials, just call the #connect method thus:</p>

<pre class="code ruby"><code class="ruby"><span class='const'><span class='object_link'><a href="../JSS.html" title="JSS (module)">JSS</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../JSS.html#DB_CNX-constant" title="JSS::DB_CNX (constant)">DB_CNX</a></span></span><span class='period'>.</span><span class='id identifier rubyid_connect'>connect</span> <span class='symbol'>:server</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>server.company.com</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='symbol'>:user</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>user</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:pw</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>pw</span><span class='tstring_end'>&quot;</span></span>
</code></pre>

<p>Other options include:</p>

<pre class="code ruby"><code class="ruby">:db_name =&gt; which database to connect to, defaults to &#39;jamfsoftware&#39;
:port =&gt; tcp port for connection to server, defaults to the standard mysql port.
:connect_timeout =&gt; seconds to wait before giving up on connection, defaults to 120
:read_timeout =&gt; seconds to wait before giving up on recieving data, defaults to 120
:write_timeout =&gt; seconds to wait before giving up on sending data, defaults to 120
:timeout =&gt; sets all three timeouts to the same value, defaults to 120
</code></pre>

<p>Calling JSS::DB_CNX.connect again will re-use any values not provided. but will create a new connection.</p>


  </div>
</div>
<div class="tags">
  

</div>
  
    <h2>
      Constant Summary
      <small><a href="#" class="constants_summary_toggle">collapse</a></small>
    </h2>

    <dl class="constants">
      
        <dt id="DEFAULT_DB_NAME-constant" class="">DEFAULT_DB_NAME =
          <div class="docstring">
  <div class="discussion">
    
<p>The name of the JSS database on the mysql server</p>


  </div>
</div>
<div class="tags">
  

</div>
        </dt>
        <dd><pre class="code"><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>jamfsoftware</span><span class='tstring_end'>&#39;</span></span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span></pre></dd>
      
        <dt id="DFT_TIMEOUT-constant" class="">DFT_TIMEOUT =
          <div class="docstring">
  <div class="discussion">
    
<p>give the connection a 60 second timeout, for really slow net connections (likeâ€¦ from airplanes)</p>


  </div>
</div>
<div class="tags">
  

</div>
        </dt>
        <dd><pre class="code"><span class='int'>60</span></pre></dd>
      
        <dt id="DFT_SOCKET-constant" class="">DFT_SOCKET =
          
        </dt>
        <dd><pre class="code"><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/var/mysql/mysql.sock</span><span class='tstring_end'>&#39;</span></span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span></pre></dd>
      
        <dt id="DFT_PORT-constant" class="">DFT_PORT =
          <div class="docstring">
  <div class="discussion">
    
<p>the default MySQL port</p>


  </div>
</div>
<div class="tags">
  

</div>
        </dt>
        <dd><pre class="code"><span class='int'>3306</span></pre></dd>
      
        <dt id="DFT_CHARSET-constant" class="">DFT_CHARSET =
          <div class="docstring">
  <div class="discussion">
    
<p>The default encoding in the tables - JAMF wisely uses UTF-8</p>


  </div>
</div>
<div class="tags">
  

</div>
        </dt>
        <dd><pre class="code"><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>utf8</span><span class='tstring_end'>&#39;</span></span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span></pre></dd>
      
        <dt id="SQL_DATE_FORMAT-constant" class="">SQL_DATE_FORMAT =
          <div class="docstring">
  <div class="discussion">
    
<p>the strftime format for reading/writing dates in the db</p>


  </div>
</div>
<div class="tags">
  

</div>
        </dt>
        <dd><pre class="code"><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>%Y-%m-%d %H:%M:%S</span><span class='tstring_end'>&#39;</span></span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span></pre></dd>
      
    </dl>
  




  <h2>Instance Attribute Summary <small><a href="#" class="summary_toggle">collapse</a></small></h2>
  <ul class="summary">
    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#connect_timeout-instance_method" title="#connect_timeout (instance method)">#<strong>connect_timeout</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns the value of attribute connect_timeout.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#connected-instance_method" title="#connected (instance method)">#<strong>connected</strong>  &#x21d2; Object </a>
    

    
      (also: #connected?)
    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns the value of attribute connected.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#db_name-instance_method" title="#db_name (instance method)">#<strong>db_name</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns the value of attribute db_name.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#port-instance_method" title="#port (instance method)">#<strong>port</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns the value of attribute port.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#read_timeout-instance_method" title="#read_timeout (instance method)">#<strong>read_timeout</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns the value of attribute read_timeout.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#server-instance_method" title="#server (instance method)">#<strong>server</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns the value of attribute server.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#socket-instance_method" title="#socket (instance method)">#<strong>socket</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns the value of attribute socket.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#user-instance_method" title="#user (instance method)">#<strong>user</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns the value of attribute user.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#write_timeout-instance_method" title="#write_timeout (instance method)">#<strong>write_timeout</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns the value of attribute write_timeout.</p>
</div></span>
  
</li>

    
  </ul>




  
    <h2>
      Instance Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#connect-instance_method" title="#connect (instance method)">#<strong>connect</strong>(args = {})  &#x21d2; true </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Connect to the JSS MySQL database.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#db-instance_method" title="#db (instance method)">#<strong>db</strong>  &#x21d2; Mysql </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>The mysql database connection itself.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#disconnect-instance_method" title="#disconnect (instance method)">#<strong>disconnect</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>close the connection to the database it&#39;ll have to be re-connected before using again.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#hostname-instance_method" title="#hostname (instance method)">#<strong>hostname</strong>  &#x21d2; String </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>The server to which we are connected, or will try connecting to if none is specified with the call to #connect.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#initialize-instance_method" title="#initialize (instance method)">#<strong>initialize</strong>  &#x21d2; DBConnection </a>
    

    
  </span>
  
  
    <span class="note title constructor">constructor</span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>A new instance of DBConnection.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#valid_server%3F-instance_method" title="#valid_server? (instance method)">#<strong>valid_server?</strong>(server, port = DFT_PORT)  &#x21d2; Boolean </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Test that a given hostname is a MySQL server.</p>
</div></span>
  
</li>

      
    </ul>
  


  <div id="constructor_details" class="method_details_list">
  <h2>Constructor Details</h2>
  
    <div class="method_details first">
  <h3 class="signature first" id="initialize-instance_method">
  
    #<strong>initialize</strong>  &#x21d2; <tt><span class='object_link'><a href="" title="JSS::DBConnection (class)">DBConnection</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns a new instance of DBConnection.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


106
107
108
109
110</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/jss/db_connection.rb', line 106</span>

<span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span>
  <span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>mysql</span><span class='tstring_end'>&#39;</span></span>
  <span class='ivar'>@mysql</span> <span class='op'>=</span> <span class='const'>Mysql</span><span class='period'>.</span><span class='id identifier rubyid_init'>init</span>
  <span class='ivar'>@connected</span> <span class='op'>=</span> <span class='kw'>false</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
  
</div>

  <div id="instance_attr_details" class="attr_details">
    <h2>Instance Attribute Details</h2>
    
      
      <span id=""></span>
      <div class="method_details first">
  <h3 class="signature first" id="connect_timeout-instance_method">
  
    #<strong>connect_timeout</strong>  &#x21d2; <tt><span class='object_link'><a href="../Object.html" title="Object (class)">Object</a></span></tt>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns the value of attribute connect_timeout.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


101
102
103</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/jss/db_connection.rb', line 101</span>

<span class='kw'>def</span> <span class='id identifier rubyid_connect_timeout'>connect_timeout</span>
  <span class='ivar'>@connect_timeout</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <div class="method_details ">
  <h3 class="signature " id="connected-instance_method">
  
    #<strong>connected</strong>  &#x21d2; <tt><span class='object_link'><a href="../Object.html" title="Object (class)">Object</a></span></tt>  <span class="extras">(readonly)</span>
  

  
    <span class="aliases">Also known as:
    <span class="names"><span id='connected?-instance_method'>connected?</span></span>
    </span>
  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns the value of attribute connected.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


104
105
106</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/jss/db_connection.rb', line 104</span>

<span class='kw'>def</span> <span class='id identifier rubyid_connected'>connected</span>
  <span class='ivar'>@connected</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <div class="method_details ">
  <h3 class="signature " id="db_name-instance_method">
  
    #<strong>db_name</strong>  &#x21d2; <tt><span class='object_link'><a href="../Object.html" title="Object (class)">Object</a></span></tt>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns the value of attribute db_name.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


100
101
102</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/jss/db_connection.rb', line 100</span>

<span class='kw'>def</span> <span class='id identifier rubyid_db_name'>db_name</span>
  <span class='ivar'>@db_name</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <div class="method_details ">
  <h3 class="signature " id="port-instance_method">
  
    #<strong>port</strong>  &#x21d2; <tt><span class='object_link'><a href="../Object.html" title="Object (class)">Object</a></span></tt>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns the value of attribute port.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


97
98
99</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/jss/db_connection.rb', line 97</span>

<span class='kw'>def</span> <span class='id identifier rubyid_port'>port</span>
  <span class='ivar'>@port</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <div class="method_details ">
  <h3 class="signature " id="read_timeout-instance_method">
  
    #<strong>read_timeout</strong>  &#x21d2; <tt><span class='object_link'><a href="../Object.html" title="Object (class)">Object</a></span></tt>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns the value of attribute read_timeout.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


102
103
104</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/jss/db_connection.rb', line 102</span>

<span class='kw'>def</span> <span class='id identifier rubyid_read_timeout'>read_timeout</span>
  <span class='ivar'>@read_timeout</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <div class="method_details ">
  <h3 class="signature " id="server-instance_method">
  
    #<strong>server</strong>  &#x21d2; <tt><span class='object_link'><a href="../Object.html" title="Object (class)">Object</a></span></tt>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns the value of attribute server.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


96
97
98</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/jss/db_connection.rb', line 96</span>

<span class='kw'>def</span> <span class='id identifier rubyid_server'>server</span>
  <span class='ivar'>@server</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <div class="method_details ">
  <h3 class="signature " id="socket-instance_method">
  
    #<strong>socket</strong>  &#x21d2; <tt><span class='object_link'><a href="../Object.html" title="Object (class)">Object</a></span></tt>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns the value of attribute socket.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


98
99
100</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/jss/db_connection.rb', line 98</span>

<span class='kw'>def</span> <span class='id identifier rubyid_socket'>socket</span>
  <span class='ivar'>@socket</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <div class="method_details ">
  <h3 class="signature " id="user-instance_method">
  
    #<strong>user</strong>  &#x21d2; <tt><span class='object_link'><a href="../Object.html" title="Object (class)">Object</a></span></tt>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns the value of attribute user.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


99
100
101</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/jss/db_connection.rb', line 99</span>

<span class='kw'>def</span> <span class='id identifier rubyid_user'>user</span>
  <span class='ivar'>@user</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <div class="method_details ">
  <h3 class="signature " id="write_timeout-instance_method">
  
    #<strong>write_timeout</strong>  &#x21d2; <tt><span class='object_link'><a href="../Object.html" title="Object (class)">Object</a></span></tt>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns the value of attribute write_timeout.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


103
104
105</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/jss/db_connection.rb', line 103</span>

<span class='kw'>def</span> <span class='id identifier rubyid_write_timeout'>write_timeout</span>
  <span class='ivar'>@write_timeout</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>


  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="connect-instance_method">
  
    #<strong>connect</strong>(args = {})  &#x21d2; <tt>true</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Connect to the JSS MySQL database.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>args</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../Hash.html" title="Hash (class)">Hash</a></span></tt>)</span>
      
      
        <em class="default">(defaults to: <tt>{}</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>the keyed arguments for connection.</p>
</div>
      
    </li>
  
</ul>

  
    
    
    <p class="tag_title">Options Hash (<tt>args</tt>):</p>
    <ul class="option">
      
        <li>
          <span class="name">:server</span>
          <span class="type">(<tt><span class='object_link'><a href="../String.html" title="String (class)">String</a></span></tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>Required, the hostname of the JSS API server</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:port</span>
          <span class="type">(<tt>Integer</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>the port number to connect with, defaults to the default Mysql TCP port</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:socket</span>
          <span class="type">(<tt><span class='object_link'><a href="../String.html" title="String (class)">String</a></span></tt>, <tt><span class='object_link'><a href="../Pathname.html" title="Pathname (class)">Pathname</a></span></tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>when the server is &#39;localhost&#39;, the path to the connection socket.</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:db_name</span>
          <span class="type">(<tt><span class='object_link'><a href="../String.html" title="String (class)">String</a></span></tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>the name of the database to use, defaults to &#39;jamfsoftware&#39;</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:user</span>
          <span class="type">(<tt><span class='object_link'><a href="../String.html" title="String (class)">String</a></span></tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>Required, the mysql user to connect as</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:pw</span>
          <span class="type">(<tt><span class='object_link'><a href="../String.html" title="String (class)">String</a></span></tt>, <tt>Symbol</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>Required, the password for that user, or :prompt, or :stdin If :prompt, the user is promted on the commandline to enter the password for the :user. If :stdin#, the password is read from a line of std in represented by the digit at #, so :stdin3 reads the passwd from the third line of standard input. defaults to line 2, if no digit is supplied. see <span class='object_link'><a href="../JSS.html#stdin-class_method" title="JSS.stdin (method)">JSS.stdin</a></span></p>
</div>
          
        </li>
      
        <li>
          <span class="name">:connect_timeout</span>
          <span class="type">(<tt>Integer</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>the number of seconds to wait for an initial response, defaults to 120</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:read_timeout</span>
          <span class="type">(<tt>Integer</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>the number of seconds before read-request times out, defaults to 120</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:write_timeout</span>
          <span class="type">(<tt>Integer</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>the number of seconds before write-request times out, defaults to 120</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:timeout</span>
          <span class="type">(<tt>Integer</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>used for any of the timeouts that aren&#39;t explicitly set.</p>
</div>
          
        </li>
      
    </ul>
  

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>true</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>the connection was successfully made.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/jss/db_connection.rb', line 143</span>

<span class='kw'>def</span> <span class='id identifier rubyid_connect'>connect</span><span class='lparen'>(</span><span class='id identifier rubyid_args'>args</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span>
  <span class='kw'>begin</span>
    <span class='id identifier rubyid_disconnect'>disconnect</span> <span class='kw'>if</span> <span class='ivar'>@connected</span>
  <span class='kw'>rescue</span> <span class='const'>Mysql</span><span class='op'>::</span><span class='const'>ClientError</span><span class='op'>::</span><span class='const'>ServerGoneError</span>
    <span class='ivar'>@connected</span> <span class='op'>=</span> <span class='kw'>false</span>
  <span class='kw'>end</span>

  <span class='comment'># server might come frome several places
</span>  <span class='comment'># if not given in the args, use #hostname to figure out
</span>  <span class='comment'># which
</span>  <span class='ivar'>@server</span> <span class='op'>=</span> <span class='id identifier rubyid_args'>args</span><span class='lbracket'>[</span><span class='symbol'>:server</span><span class='rbracket'>]</span> <span class='op'>?</span> <span class='id identifier rubyid_args'>args</span><span class='lbracket'>[</span><span class='symbol'>:server</span><span class='rbracket'>]</span> <span class='op'>:</span> <span class='id identifier rubyid_hostname'>hostname</span>

  <span class='comment'># settings from config if they aren&#39;t in the args
</span>  <span class='id identifier rubyid_args'>args</span><span class='lbracket'>[</span><span class='symbol'>:port</span><span class='rbracket'>]</span> <span class='op'>||=</span> <span class='const'><span class='object_link'><a href="../JSS.html" title="JSS (module)">JSS</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../JSS.html#CONFIG-constant" title="JSS::CONFIG (constant)">CONFIG</a></span></span><span class='period'>.</span><span class='id identifier rubyid_db_server_port'>db_server_port</span> <span class='op'>?</span> <span class='const'><span class='object_link'><a href="../JSS.html" title="JSS (module)">JSS</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../JSS.html#CONFIG-constant" title="JSS::CONFIG (constant)">CONFIG</a></span></span><span class='period'>.</span><span class='id identifier rubyid_db_server_port'>db_server_port</span> <span class='op'>:</span> <span class='const'>Mysql</span><span class='op'>::</span><span class='const'>MYSQL_TCP_PORT</span>
  <span class='id identifier rubyid_args'>args</span><span class='lbracket'>[</span><span class='symbol'>:socket</span><span class='rbracket'>]</span> <span class='op'>||=</span> <span class='const'><span class='object_link'><a href="../JSS.html" title="JSS (module)">JSS</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../JSS.html#CONFIG-constant" title="JSS::CONFIG (constant)">CONFIG</a></span></span><span class='period'>.</span><span class='id identifier rubyid_db_server_socket'>db_server_socket</span> <span class='op'>?</span> <span class='const'><span class='object_link'><a href="../JSS.html" title="JSS (module)">JSS</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../JSS.html#CONFIG-constant" title="JSS::CONFIG (constant)">CONFIG</a></span></span><span class='period'>.</span><span class='id identifier rubyid_db_server_socket'>db_server_socket</span> <span class='op'>:</span> <span class='const'><span class='object_link'><a href="#DFT_SOCKET-constant" title="JSS::DBConnection::DFT_SOCKET (constant)">DFT_SOCKET</a></span></span>
  <span class='id identifier rubyid_args'>args</span><span class='lbracket'>[</span><span class='symbol'>:db_name</span><span class='rbracket'>]</span> <span class='op'>||=</span> <span class='const'><span class='object_link'><a href="../JSS.html" title="JSS (module)">JSS</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../JSS.html#CONFIG-constant" title="JSS::CONFIG (constant)">CONFIG</a></span></span><span class='period'>.</span><span class='id identifier rubyid_db_name'>db_name</span> <span class='op'>?</span> <span class='const'><span class='object_link'><a href="../JSS.html" title="JSS (module)">JSS</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../JSS.html#CONFIG-constant" title="JSS::CONFIG (constant)">CONFIG</a></span></span><span class='period'>.</span><span class='id identifier rubyid_db_name'>db_name</span> <span class='op'>:</span> <span class='const'><span class='object_link'><a href="#DEFAULT_DB_NAME-constant" title="JSS::DBConnection::DEFAULT_DB_NAME (constant)">DEFAULT_DB_NAME</a></span></span>
  <span class='id identifier rubyid_args'>args</span><span class='lbracket'>[</span><span class='symbol'>:user</span><span class='rbracket'>]</span> <span class='op'>||=</span> <span class='const'><span class='object_link'><a href="../JSS.html" title="JSS (module)">JSS</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../JSS.html#CONFIG-constant" title="JSS::CONFIG (constant)">CONFIG</a></span></span><span class='period'>.</span><span class='id identifier rubyid_db_username'>db_username</span>
  <span class='id identifier rubyid_args'>args</span><span class='lbracket'>[</span><span class='symbol'>:connect_timeout</span><span class='rbracket'>]</span> <span class='op'>||=</span> <span class='const'><span class='object_link'><a href="../JSS.html" title="JSS (module)">JSS</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../JSS.html#CONFIG-constant" title="JSS::CONFIG (constant)">CONFIG</a></span></span><span class='period'>.</span><span class='id identifier rubyid_db_connect_timeout'>db_connect_timeout</span>
  <span class='id identifier rubyid_args'>args</span><span class='lbracket'>[</span><span class='symbol'>:read_timeout</span><span class='rbracket'>]</span> <span class='op'>||=</span> <span class='const'><span class='object_link'><a href="../JSS.html" title="JSS (module)">JSS</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../JSS.html#CONFIG-constant" title="JSS::CONFIG (constant)">CONFIG</a></span></span><span class='period'>.</span><span class='id identifier rubyid_db_read_timeout'>db_read_timeout</span>
  <span class='id identifier rubyid_args'>args</span><span class='lbracket'>[</span><span class='symbol'>:write_timeout</span><span class='rbracket'>]</span> <span class='op'>||=</span> <span class='const'><span class='object_link'><a href="../JSS.html" title="JSS (module)">JSS</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../JSS.html#CONFIG-constant" title="JSS::CONFIG (constant)">CONFIG</a></span></span><span class='period'>.</span><span class='id identifier rubyid_db_write_timeout'>db_write_timeout</span>
  <span class='id identifier rubyid_args'>args</span><span class='lbracket'>[</span><span class='symbol'>:charset</span><span class='rbracket'>]</span> <span class='op'>||=</span> <span class='const'><span class='object_link'><a href="#DFT_CHARSET-constant" title="JSS::DBConnection::DFT_CHARSET (constant)">DFT_CHARSET</a></span></span>

  <span class='comment'>### if one timeout was given, use it for all three
</span>  <span class='id identifier rubyid_args'>args</span><span class='lbracket'>[</span><span class='symbol'>:connect_timeout</span><span class='rbracket'>]</span> <span class='op'>||=</span> <span class='id identifier rubyid_args'>args</span><span class='lbracket'>[</span><span class='symbol'>:timeout</span><span class='rbracket'>]</span> <span class='op'>?</span> <span class='id identifier rubyid_args'>args</span><span class='lbracket'>[</span><span class='symbol'>:timeout</span><span class='rbracket'>]</span> <span class='op'>:</span> <span class='const'><span class='object_link'><a href="#DFT_TIMEOUT-constant" title="JSS::DBConnection::DFT_TIMEOUT (constant)">DFT_TIMEOUT</a></span></span>
  <span class='id identifier rubyid_args'>args</span><span class='lbracket'>[</span><span class='symbol'>:read_timeout</span><span class='rbracket'>]</span> <span class='op'>||=</span> <span class='id identifier rubyid_args'>args</span><span class='lbracket'>[</span><span class='symbol'>:timeout</span><span class='rbracket'>]</span> <span class='op'>?</span> <span class='id identifier rubyid_args'>args</span><span class='lbracket'>[</span><span class='symbol'>:timeout</span><span class='rbracket'>]</span> <span class='op'>:</span> <span class='const'><span class='object_link'><a href="#DFT_TIMEOUT-constant" title="JSS::DBConnection::DFT_TIMEOUT (constant)">DFT_TIMEOUT</a></span></span>
  <span class='id identifier rubyid_args'>args</span><span class='lbracket'>[</span><span class='symbol'>:write_timeout</span><span class='rbracket'>]</span> <span class='op'>||=</span> <span class='id identifier rubyid_args'>args</span><span class='lbracket'>[</span><span class='symbol'>:timeout</span><span class='rbracket'>]</span> <span class='op'>?</span> <span class='id identifier rubyid_args'>args</span><span class='lbracket'>[</span><span class='symbol'>:timeout</span><span class='rbracket'>]</span> <span class='op'>:</span> <span class='const'><span class='object_link'><a href="#DFT_TIMEOUT-constant" title="JSS::DBConnection::DFT_TIMEOUT (constant)">DFT_TIMEOUT</a></span></span>

  <span class='ivar'>@port</span> <span class='op'>=</span> <span class='id identifier rubyid_args'>args</span><span class='lbracket'>[</span><span class='symbol'>:port</span><span class='rbracket'>]</span>
  <span class='ivar'>@socket</span> <span class='op'>=</span> <span class='id identifier rubyid_args'>args</span><span class='lbracket'>[</span><span class='symbol'>:socket</span><span class='rbracket'>]</span>
  <span class='ivar'>@mysql_name</span> <span class='op'>=</span> <span class='id identifier rubyid_args'>args</span><span class='lbracket'>[</span><span class='symbol'>:db_name</span><span class='rbracket'>]</span>
  <span class='ivar'>@user</span> <span class='op'>=</span> <span class='id identifier rubyid_args'>args</span><span class='lbracket'>[</span><span class='symbol'>:user</span><span class='rbracket'>]</span>
  <span class='ivar'>@connect_timeout</span> <span class='op'>=</span> <span class='id identifier rubyid_args'>args</span><span class='lbracket'>[</span><span class='symbol'>:connect_timeout</span><span class='rbracket'>]</span>
  <span class='ivar'>@read_timeout</span> <span class='op'>=</span> <span class='id identifier rubyid_args'>args</span><span class='lbracket'>[</span><span class='symbol'>:read_timeout</span><span class='rbracket'>]</span>
  <span class='ivar'>@write_timeout</span> <span class='op'>=</span> <span class='id identifier rubyid_args'>args</span><span class='lbracket'>[</span><span class='symbol'>:write_timeout</span><span class='rbracket'>]</span>

  <span class='comment'># make sure we have a user, pw, server
</span>  <span class='id identifier rubyid_raise'>raise</span> <span class='const'><span class='object_link'><a href="../JSS.html" title="JSS (module)">JSS</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="MissingDataError.html" title="JSS::MissingDataError (class)">MissingDataError</a></span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>No MySQL user specified, or defined in configuration.</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>unless</span> <span class='id identifier rubyid_args'>args</span><span class='lbracket'>[</span><span class='symbol'>:user</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'><span class='object_link'><a href="../JSS.html" title="JSS (module)">JSS</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="MissingDataError.html" title="JSS::MissingDataError (class)">MissingDataError</a></span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Missing :pw (or :prompt/:stdin) for user &#39;</span><span class='embexpr_beg'>#{</span><span class='ivar'>@user</span><span class='embexpr_end'>}</span><span class='tstring_content'>&#39;</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>unless</span> <span class='id identifier rubyid_args'>args</span><span class='lbracket'>[</span><span class='symbol'>:pw</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'><span class='object_link'><a href="../JSS.html" title="JSS (module)">JSS</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="MissingDataError.html" title="JSS::MissingDataError (class)">MissingDataError</a></span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>No MySQL Server hostname specified, or listed in configuration.</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>unless</span> <span class='ivar'>@server</span>

  <span class='ivar'>@pw</span> <span class='op'>=</span> <span class='kw'>if</span> <span class='id identifier rubyid_args'>args</span><span class='lbracket'>[</span><span class='symbol'>:pw</span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='symbol'>:prompt</span>
          <span class='const'><span class='object_link'><a href="../JSS.html" title="JSS (module)">JSS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_prompt_for_password'><span class='object_link'><a href="../JSS.html#prompt_for_password-class_method" title="JSS.prompt_for_password (method)">prompt_for_password</a></span></span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Enter the password for the MySQL user </span><span class='embexpr_beg'>#{</span><span class='ivar'>@user</span><span class='embexpr_end'>}</span><span class='tstring_content'>@</span><span class='embexpr_beg'>#{</span><span class='ivar'>@server</span><span class='embexpr_end'>}</span><span class='tstring_content'>:</span><span class='tstring_end'>&quot;</span></span>
        <span class='kw'>elsif</span> <span class='id identifier rubyid_args'>args</span><span class='lbracket'>[</span><span class='symbol'>:pw</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>Symbol</span><span class='rparen'>)</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_args'>args</span><span class='lbracket'>[</span><span class='symbol'>:pw</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='period'>.</span><span class='id identifier rubyid_start_with?'>start_with?</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>stdin</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
          <span class='id identifier rubyid_args'>args</span><span class='lbracket'>[</span><span class='symbol'>:pw</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span> <span class='op'>=~</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>^stdin(\d+)$</span><span class='regexp_end'>/</span></span>
          <span class='id identifier rubyid_line'>line</span> <span class='op'>=</span> <span class='const'>Regexp</span><span class='period'>.</span><span class='id identifier rubyid_last_match'>last_match</span><span class='lparen'>(</span><span class='int'>1</span><span class='rparen'>)</span>
          <span class='id identifier rubyid_line'>line</span> <span class='op'>||=</span> <span class='int'>2</span>
          <span class='const'><span class='object_link'><a href="../JSS.html" title="JSS (module)">JSS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_stdin'><span class='object_link'><a href="../JSS.html#stdin-class_method" title="JSS.stdin (method)">stdin</a></span></span> <span class='id identifier rubyid_line'>line</span>
        <span class='kw'>else</span>
          <span class='id identifier rubyid_args'>args</span><span class='lbracket'>[</span><span class='symbol'>:pw</span><span class='rbracket'>]</span>
        <span class='kw'>end</span>

  <span class='ivar'>@mysql</span> <span class='op'>=</span> <span class='const'>Mysql</span><span class='period'>.</span><span class='id identifier rubyid_init'>init</span>

  <span class='ivar'>@mysql</span><span class='period'>.</span><span class='id identifier rubyid_options'>options</span> <span class='const'>Mysql</span><span class='op'>::</span><span class='const'>OPT_CONNECT_TIMEOUT</span><span class='comma'>,</span> <span class='ivar'>@connect_timeout</span>
  <span class='ivar'>@mysql</span><span class='period'>.</span><span class='id identifier rubyid_options'>options</span> <span class='const'>Mysql</span><span class='op'>::</span><span class='const'>OPT_READ_TIMEOUT</span><span class='comma'>,</span> <span class='ivar'>@read_timeout</span>
  <span class='ivar'>@mysql</span><span class='period'>.</span><span class='id identifier rubyid_options'>options</span> <span class='const'>Mysql</span><span class='op'>::</span><span class='const'>OPT_WRITE_TIMEOUT</span><span class='comma'>,</span> <span class='ivar'>@write_timeout</span>
  <span class='ivar'>@mysql</span><span class='period'>.</span><span class='id identifier rubyid_charset'>charset</span> <span class='op'>=</span> <span class='id identifier rubyid_args'>args</span><span class='lbracket'>[</span><span class='symbol'>:charset</span><span class='rbracket'>]</span>
  <span class='ivar'>@mysql</span><span class='period'>.</span><span class='id identifier rubyid_connect'>connect</span> <span class='ivar'>@server</span><span class='comma'>,</span> <span class='ivar'>@user</span><span class='comma'>,</span> <span class='ivar'>@pw</span><span class='comma'>,</span> <span class='ivar'>@mysql_name</span><span class='comma'>,</span> <span class='ivar'>@port</span><span class='comma'>,</span> <span class='ivar'>@socket</span>

  <span class='ivar'>@connected</span> <span class='op'>=</span> <span class='kw'>true</span>

  <span class='ivar'>@server</span>
<span class='kw'>rescue</span> <span class='const'>Mysql</span><span class='op'>::</span><span class='const'>ServerError</span><span class='op'>::</span><span class='const'>NotSupportedAuthMode</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_e'>e</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'>Mysql</span><span class='op'>::</span><span class='const'>ServerError</span><span class='op'>::</span><span class='const'>AccessDeniedError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Probable unknown MySQL user &#39;</span><span class='embexpr_beg'>#{</span><span class='ivar'>@user</span><span class='embexpr_end'>}</span><span class='tstring_content'>&#39;. Original error was &#39;Mysql::ServerError::NotSupportedAuthMode: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'>e</span><span class='embexpr_end'>}</span><span class='tstring_content'>&#39; which is sometimes raised when the user does not exist on the server.</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="db-instance_method">
  
    #<strong>db</strong>  &#x21d2; <tt>Mysql</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns The mysql database connection itself.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Mysql</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The mysql database connection itself</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="InvalidConnectionError.html" title="JSS::InvalidConnectionError (class)">JSS::InvalidConnectionError</a></span></tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


212
213
214
215</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/jss/db_connection.rb', line 212</span>

<span class='kw'>def</span> <span class='id identifier rubyid_db'>db</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'><span class='object_link'><a href="../JSS.html" title="JSS (module)">JSS</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="InvalidConnectionError.html" title="JSS::InvalidConnectionError (class)">InvalidConnectionError</a></span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>No database connection. Please use JSS::DB_CNX.connect</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>unless</span> <span class='const'><span class='object_link'><a href="../JSS.html" title="JSS (module)">JSS</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../JSS.html#DB_CNX-constant" title="JSS::DB_CNX (constant)">DB_CNX</a></span></span><span class='period'>.</span><span class='id identifier rubyid_connected?'>connected?</span>
  <span class='ivar'>@mysql</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="disconnect-instance_method">
  
    #<strong>disconnect</strong>  &#x21d2; <tt><span class='object_link'><a href="../Object.html" title="Object (class)">Object</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>close the connection to the database it&#39;ll have to be re-connected before using again</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


221
222
223
224
225
226
227
228
229
230
231
232</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/jss/db_connection.rb', line 221</span>

<span class='kw'>def</span> <span class='id identifier rubyid_disconnect'>disconnect</span>
  <span class='ivar'>@mysql</span><span class='period'>.</span><span class='id identifier rubyid_close!'>close!</span> <span class='kw'>if</span> <span class='ivar'>@mysql</span><span class='period'>.</span><span class='id identifier rubyid_protocol'>protocol</span>
  <span class='ivar'>@server</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='ivar'>@port</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='ivar'>@socket</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='ivar'>@user</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='ivar'>@connection_timeout</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="#DFT_TIMEOUT-constant" title="JSS::DBConnection::DFT_TIMEOUT (constant)">DFT_TIMEOUT</a></span></span>
  <span class='ivar'>@read_timeout</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="#DFT_TIMEOUT-constant" title="JSS::DBConnection::DFT_TIMEOUT (constant)">DFT_TIMEOUT</a></span></span>
  <span class='ivar'>@write_timeout</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="#DFT_TIMEOUT-constant" title="JSS::DBConnection::DFT_TIMEOUT (constant)">DFT_TIMEOUT</a></span></span>
  <span class='ivar'>@connected</span> <span class='op'>=</span> <span class='kw'>false</span>
  <span class='kw'>nil</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="hostname-instance_method">
  
    #<strong>hostname</strong>  &#x21d2; <tt><span class='object_link'><a href="../String.html" title="String (class)">String</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>The server to which we are connected, or will try connecting to if none is specified with the call to #connect</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../String.html" title="String (class)">String</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>the hostname of the server</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


271
272
273
274
275
276
277
278
279</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/jss/db_connection.rb', line 271</span>

<span class='kw'>def</span> <span class='id identifier rubyid_hostname'>hostname</span>
  <span class='comment'># return it if already set
</span>  <span class='kw'>return</span> <span class='ivar'>@server</span> <span class='kw'>if</span> <span class='ivar'>@server</span>
  <span class='comment'># otherwise, from the config
</span>  <span class='id identifier rubyid_srvr'>srvr</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../JSS.html" title="JSS (module)">JSS</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../JSS.html#CONFIG-constant" title="JSS::CONFIG (constant)">CONFIG</a></span></span><span class='period'>.</span><span class='id identifier rubyid_db_server_name'>db_server_name</span>
  <span class='comment'># otherwise, assume its on the JSS server to which this client talks
</span>  <span class='id identifier rubyid_srvr'>srvr</span> <span class='op'>||=</span> <span class='const'><span class='object_link'><a href="../JSS.html" title="JSS (module)">JSS</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Client.html" title="JSS::Client (class)">Client</a></span></span><span class='period'>.</span><span class='id identifier rubyid_jss_server'><span class='object_link'><a href="Client.html#jss_server-class_method" title="JSS::Client.jss_server (method)">jss_server</a></span></span>
  <span class='id identifier rubyid_srvr'>srvr</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="valid_server?-instance_method">
  
    #<strong>valid_server?</strong>(server, port = DFT_PORT)  &#x21d2; <tt>Boolean</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Test that a given hostname is a MySQL server</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>server</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../String.html" title="String (class)">String</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The hostname to test</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>does the server host a MySQL server?</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/jss/db_connection.rb', line 240</span>

<span class='kw'>def</span> <span class='id identifier rubyid_valid_server?'>valid_server?</span><span class='lparen'>(</span><span class='id identifier rubyid_server'>server</span><span class='comma'>,</span> <span class='id identifier rubyid_port'>port</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="#DFT_PORT-constant" title="JSS::DBConnection::DFT_PORT (constant)">DFT_PORT</a></span></span><span class='rparen'>)</span>
  <span class='id identifier rubyid_mysql'>mysql</span> <span class='op'>=</span> <span class='const'>Mysql</span><span class='period'>.</span><span class='id identifier rubyid_init'>init</span>
  <span class='id identifier rubyid_mysql'>mysql</span><span class='period'>.</span><span class='id identifier rubyid_options'>options</span> <span class='const'>Mysql</span><span class='op'>::</span><span class='const'>OPT_CONNECT_TIMEOUT</span><span class='comma'>,</span> <span class='int'>60</span>
  <span class='id identifier rubyid_mysql'>mysql</span><span class='period'>.</span><span class='id identifier rubyid_charset'>charset</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="#DFT_CHARSET-constant" title="JSS::DBConnection::DFT_CHARSET (constant)">DFT_CHARSET</a></span></span>

  <span class='kw'>begin</span>
    <span class='comment'># this connection should get an access denied error if there is
</span>    <span class='comment'># a mysql server there. I&#39;m assuming no one will use this username
</span>    <span class='comment'># and pw for anything real
</span>    <span class='comment'># Also with newer versions of mysql, a Mysql instance that has
</span>    <span class='comment'># never authenticated will raise Mysql::ServerError::NotSupportedAuthMode
</span>    <span class='comment'># rather than Mysql::ServerError::AccessDeniedError, until a
</span>    <span class='comment'># successful connection is made. After that, re-connecting will
</span>    <span class='comment'># raise AccessDeniedError when credentials are invalid.
</span>
    <span class='id identifier rubyid_mysql'>mysql</span><span class='period'>.</span><span class='id identifier rubyid_connect'>connect</span> <span class='id identifier rubyid_server'>server</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>notArealUser</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>definatelyNotA</span><span class='embexpr_beg'>#{</span><span class='gvar'>$PROCESS_ID</span><span class='embexpr_end'>}</span><span class='tstring_content'>password</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>not_a_db</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_port'>port</span>

  <span class='kw'>rescue</span> <span class='const'>Mysql</span><span class='op'>::</span><span class='const'>ServerError</span><span class='op'>::</span><span class='const'>AccessDeniedError</span><span class='comma'>,</span> <span class='const'>Mysql</span><span class='op'>::</span><span class='const'>ServerError</span><span class='op'>::</span><span class='const'>NotSupportedAuthMode</span>
    <span class='kw'>return</span> <span class='kw'>true</span>
  <span class='kw'>rescue</span>
    <span class='kw'>return</span> <span class='kw'>false</span>
  <span class='kw'>end</span>
  <span class='kw'>false</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

      <div id="footer">
  Generated on Wed Feb  2 11:05:51 2022 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.25 (ruby-2.6.3).
</div>

    </div>
  </body>
</html>